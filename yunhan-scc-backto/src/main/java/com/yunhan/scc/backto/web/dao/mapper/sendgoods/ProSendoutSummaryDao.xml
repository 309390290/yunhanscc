<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
	@author luohoudong
	@version 2016-7-15 16:04:14 
-->
<mapper namespace="com.yunhan.scc.backto.web.dao.mapper.sendgoods.ProSendoutSummaryDao">

	<resultMap type="ProSendoutSummaryBacktoDO" id="ProSendoutSummaryResult">
			<result property="addTime" column="ADD_TIME" />
			<result property="addUserCode" column="ADD_USER_CODE" />
			<result property="destination" column="DESTINATION" />
			<result property="followNo" column="FOLLOW_NO" />
			<result property="id" column="ID" />
			<result property="isDelete" column="IS_DELETE" />
			<result property="isExport" column="IS_EXPORT" />
			<result property="isInitiative" column="IS_INITIATIVE" />
			<result property="isSupplierAddProduct" column="IS_SUPPLIER_ADD_PRODUCT" />
			<result property="pakagesQty" column="PAKAGES_QTY" />
			<result property="purchaserId" column="PURCHASER_ID" />
			<result property="purchaseOrderCode" column="PURCHASE_ORDER_CODE" />
			<result property="receiveAddress" column="RECEIVE_ADDRESS" />
			<result property="receiveCompany" column="RECEIVE_COMPANY" />
			<result property="receivePhoneno" column="RECEIVE_PHONENO" />
			<result property="receiveRemark" column="RECEIVE_REMARK" />
			<result property="receiveUserName" column="RECEIVE_USER_NAME" />
			<result property="receiveWarehouse" column="RECEIVE_WAREHOUSE" />
			<result property="sendoutDate" column="SENDOUT_DATE" />
			<result property="sendoutGoodsCode" column="SENDOUT_GOODS_CODE" />
			<result property="sendoutRemark" column="SENDOUT_REMARK" />
			<result property="sendoutStation" column="SENDOUT_STATION" />
			<result property="sendoutStatus" column="SENDOUT_STATUS" />
			<result property="sourceType" column="SOURCE_TYPE" />
			<result property="supplierContactPhoneno" column="SUPPLIER_CONTACT_PHONENO" />
			<result property="supplierContactUser" column="SUPPLIER_CONTACT_USER" />
			<result property="supplierId" column="SUPPLIER_ID" />
			<result property="totalBookQty" column="TOTAL_BOOK_QTY" />
			<result property="totalPrice" column="TOTAL_PRICE" />
			<result property="totalRealityPrice" column="TOTAL_REALITY_PRICE" />
			<result property="totalVarietyQty" column="TOTAL_VARIETY_QTY" />
			<result property="transportCompany" column="TRANSPORT_COMPANY" />
			<result property="transportMode" column="TRANSPORT_MODE" />
			<result property="transportNo" column="TRANSPORT_NO" />
			<result property="transportPhoneno" column="TRANSPORT_PHONENO" />
			<result property="updateTime" column="UPDATE_TIME" />
			<result property="updateUserCode" column="UPDATE_USER_CODE" />
			<result property="yunhanOrderCode" column="YUNHAN_ORDER_CODE" />
			<result property="yunhanSendoutCode" column="YUNHAN_SENDOUT_CODE" />
			
			<result property="supplierName" column="supplierName" />
			<result property="purchaserName" column="purchaserName" />
			<result property="receiveWarehouseName" column="receiveWarehouseName" />
	</resultMap>

	<select id="queryByPage" resultMap="ProSendoutSummaryResult" 
		parameterType="ProSendoutSummaryBacktoCondition">
		SELECT 
			ADD_TIME ,
			ADD_USER_CODE ,
			DESTINATION ,
			FOLLOW_NO ,
			ID ,
			IS_DELETE ,
			IS_EXPORT ,
			IS_INITIATIVE ,
			IS_SUPPLIER_ADD_PRODUCT ,
			PAKAGES_QTY ,
			PURCHASER_ID ,
			PURCHASE_ORDER_CODE ,
			RECEIVE_ADDRESS ,
			RECEIVE_COMPANY ,
			RECEIVE_PHONENO ,
			RECEIVE_REMARK ,
			RECEIVE_USER_NAME ,
			RECEIVE_WAREHOUSE ,
			SENDOUT_DATE ,
			SENDOUT_GOODS_CODE ,
			SENDOUT_REMARK ,
			SENDOUT_STATION ,
			SENDOUT_STATUS ,
			SOURCE_TYPE ,
			SUPPLIER_CONTACT_PHONENO ,
			SUPPLIER_CONTACT_USER ,
			SUPPLIER_ID ,
			TOTAL_BOOK_QTY ,
			TOTAL_PRICE ,
			TOTAL_REALITY_PRICE ,
			TOTAL_VARIETY_QTY ,
			TRANSPORT_COMPANY ,
			TRANSPORT_MODE ,
			TRANSPORT_NO ,
			TRANSPORT_PHONENO ,
			UPDATE_TIME ,
			UPDATE_USER_CODE ,
			YUNHAN_ORDER_CODE ,
			YUNHAN_SENDOUT_CODE 
		FROM PRO_SENDOUT_SUMMARY 
		<where>
				<if  test="addTime!=null">
					AND ADD_TIME = #{addTime}
				</if>
				<if  test="addUserCode!=null">
					AND ADD_USER_CODE = #{addUserCode}
				</if>
				<if  test="destination!=null">
					AND DESTINATION = #{destination}
				</if>
				<if  test="followNo!=null">
					AND FOLLOW_NO = #{followNo}
				</if>
				<if  test="id!=null">
					AND ID = #{id}
				</if>
				<if  test="isDelete!=null">
					AND IS_DELETE = #{isDelete}
				</if>
				<if  test="isExport!=null">
					AND IS_EXPORT = #{isExport}
				</if>
				<if  test="isInitiative!=null">
					AND IS_INITIATIVE = #{isInitiative}
				</if>
				<if  test="isSupplierAddProduct!=null">
					AND IS_SUPPLIER_ADD_PRODUCT = #{isSupplierAddProduct}
				</if>
				<if  test="pakagesQty!=null">
					AND PAKAGES_QTY = #{pakagesQty}
				</if>
				<if  test="purchaserId!=null">
					AND PURCHASER_ID = #{purchaserId}
				</if>
				<if  test="purchaseOrderCode!=null">
					AND PURCHASE_ORDER_CODE = #{purchaseOrderCode}
				</if>
				<if  test="receiveAddress!=null">
					AND RECEIVE_ADDRESS = #{receiveAddress}
				</if>
				<if  test="receiveCompany!=null">
					AND RECEIVE_COMPANY = #{receiveCompany}
				</if>
				<if  test="receivePhoneno!=null">
					AND RECEIVE_PHONENO = #{receivePhoneno}
				</if>
				<if  test="receiveRemark!=null">
					AND RECEIVE_REMARK = #{receiveRemark}
				</if>
				<if  test="receiveUserName!=null">
					AND RECEIVE_USER_NAME = #{receiveUserName}
				</if>
				<if  test="receiveWarehouse!=null">
					AND RECEIVE_WAREHOUSE = #{receiveWarehouse}
				</if>
				<if  test="sendoutDate!=null">
					AND SENDOUT_DATE = #{sendoutDate}
				</if>
				<if  test="sendoutGoodsCode!=null">
					AND SENDOUT_GOODS_CODE = #{sendoutGoodsCode}
				</if>
				<if  test="sendoutRemark!=null">
					AND SENDOUT_REMARK = #{sendoutRemark}
				</if>
				<if  test="sendoutStation!=null">
					AND SENDOUT_STATION = #{sendoutStation}
				</if>
				<if  test="sendoutStatus!=null">
					AND SENDOUT_STATUS = #{sendoutStatus}
				</if>
				<if  test="sourceType!=null">
					AND SOURCE_TYPE = #{sourceType}
				</if>
				<if  test="supplierContactPhoneno!=null">
					AND SUPPLIER_CONTACT_PHONENO = #{supplierContactPhoneno}
				</if>
				<if  test="supplierContactUser!=null">
					AND SUPPLIER_CONTACT_USER = #{supplierContactUser}
				</if>
				<if  test="supplierId!=null">
					AND SUPPLIER_ID = #{supplierId}
				</if>
				<if  test="totalBookQty!=null">
					AND TOTAL_BOOK_QTY = #{totalBookQty}
				</if>
				<if  test="totalPrice!=null">
					AND TOTAL_PRICE = #{totalPrice}
				</if>
				<if  test="totalRealityPrice!=null">
					AND TOTAL_REALITY_PRICE = #{totalRealityPrice}
				</if>
				<if  test="totalVarietyQty!=null">
					AND TOTAL_VARIETY_QTY = #{totalVarietyQty}
				</if>
				<if  test="transportCompany!=null">
					AND TRANSPORT_COMPANY = #{transportCompany}
				</if>
				<if  test="transportMode!=null">
					AND TRANSPORT_MODE = #{transportMode}
				</if>
				<if  test="transportNo!=null">
					AND TRANSPORT_NO = #{transportNo}
				</if>
				<if  test="transportPhoneno!=null">
					AND TRANSPORT_PHONENO = #{transportPhoneno}
				</if>
				<if  test="updateTime!=null">
					AND UPDATE_TIME = #{updateTime}
				</if>
				<if  test="updateUserCode!=null">
					AND UPDATE_USER_CODE = #{updateUserCode}
				</if>
				<if  test="yunhanOrderCode!=null">
					AND YUNHAN_ORDER_CODE = #{yunhanOrderCode}
				</if>
				<if  test="yunhanSendoutCode!=null">
					AND YUNHAN_SENDOUT_CODE = #{yunhanSendoutCode}
				</if>
		</where>   		
	</select>
	
	<select id="queryByPage_count" resultType="java.lang.Integer" 
		parameterType="ProSendoutSummaryBacktoCondition">
		SELECT count(1) 
		FROM PRO_SENDOUT_SUMMARY 
		<where>
				<if  test="addTime!=null">
					AND ADD_TIME = #{addTime}
				</if>
				<if  test="addUserCode!=null">
					AND ADD_USER_CODE = #{addUserCode}
				</if>
				<if  test="destination!=null">
					AND DESTINATION = #{destination}
				</if>
				<if  test="followNo!=null">
					AND FOLLOW_NO = #{followNo}
				</if>
				<if  test="id!=null">
					AND ID = #{id}
				</if>
				<if  test="isDelete!=null">
					AND IS_DELETE = #{isDelete}
				</if>
				<if  test="isExport!=null">
					AND IS_EXPORT = #{isExport}
				</if>
				<if  test="isInitiative!=null">
					AND IS_INITIATIVE = #{isInitiative}
				</if>
				<if  test="isSupplierAddProduct!=null">
					AND IS_SUPPLIER_ADD_PRODUCT = #{isSupplierAddProduct}
				</if>
				<if  test="pakagesQty!=null">
					AND PAKAGES_QTY = #{pakagesQty}
				</if>
				<if  test="purchaserId!=null">
					AND PURCHASER_ID = #{purchaserId}
				</if>
				<if  test="purchaseOrderCode!=null">
					AND PURCHASE_ORDER_CODE = #{purchaseOrderCode}
				</if>
				<if  test="receiveAddress!=null">
					AND RECEIVE_ADDRESS = #{receiveAddress}
				</if>
				<if  test="receiveCompany!=null">
					AND RECEIVE_COMPANY = #{receiveCompany}
				</if>
				<if  test="receivePhoneno!=null">
					AND RECEIVE_PHONENO = #{receivePhoneno}
				</if>
				<if  test="receiveRemark!=null">
					AND RECEIVE_REMARK = #{receiveRemark}
				</if>
				<if  test="receiveUserName!=null">
					AND RECEIVE_USER_NAME = #{receiveUserName}
				</if>
				<if  test="receiveWarehouse!=null">
					AND RECEIVE_WAREHOUSE = #{receiveWarehouse}
				</if>
				<if  test="sendoutDate!=null">
					AND SENDOUT_DATE = #{sendoutDate}
				</if>
				<if  test="sendoutGoodsCode!=null">
					AND SENDOUT_GOODS_CODE = #{sendoutGoodsCode}
				</if>
				<if  test="sendoutRemark!=null">
					AND SENDOUT_REMARK = #{sendoutRemark}
				</if>
				<if  test="sendoutStation!=null">
					AND SENDOUT_STATION = #{sendoutStation}
				</if>
				<if  test="sendoutStatus!=null">
					AND SENDOUT_STATUS = #{sendoutStatus}
				</if>
				<if  test="sourceType!=null">
					AND SOURCE_TYPE = #{sourceType}
				</if>
				<if  test="supplierContactPhoneno!=null">
					AND SUPPLIER_CONTACT_PHONENO = #{supplierContactPhoneno}
				</if>
				<if  test="supplierContactUser!=null">
					AND SUPPLIER_CONTACT_USER = #{supplierContactUser}
				</if>
				<if  test="supplierId!=null">
					AND SUPPLIER_ID = #{supplierId}
				</if>
				<if  test="totalBookQty!=null">
					AND TOTAL_BOOK_QTY = #{totalBookQty}
				</if>
				<if  test="totalPrice!=null">
					AND TOTAL_PRICE = #{totalPrice}
				</if>
				<if  test="totalRealityPrice!=null">
					AND TOTAL_REALITY_PRICE = #{totalRealityPrice}
				</if>
				<if  test="totalVarietyQty!=null">
					AND TOTAL_VARIETY_QTY = #{totalVarietyQty}
				</if>
				<if  test="transportCompany!=null">
					AND TRANSPORT_COMPANY = #{transportCompany}
				</if>
				<if  test="transportMode!=null">
					AND TRANSPORT_MODE = #{transportMode}
				</if>
				<if  test="transportNo!=null">
					AND TRANSPORT_NO = #{transportNo}
				</if>
				<if  test="transportPhoneno!=null">
					AND TRANSPORT_PHONENO = #{transportPhoneno}
				</if>
				<if  test="updateTime!=null">
					AND UPDATE_TIME = #{updateTime}
				</if>
				<if  test="updateUserCode!=null">
					AND UPDATE_USER_CODE = #{updateUserCode}
				</if>
				<if  test="yunhanOrderCode!=null">
					AND YUNHAN_ORDER_CODE = #{yunhanOrderCode}
				</if>
				<if  test="yunhanSendoutCode!=null">
					AND YUNHAN_SENDOUT_CODE = #{yunhanSendoutCode}
				</if>
		</where>   	
	</select>
	
	<update id="update" parameterType="ProSendoutSummaryBacktoDO">
		UPDATE PRO_SENDOUT_SUMMARY
		<set>
								<if test="addTime!=null">
									ADD_TIME =#{addTime,jdbcType=TIMESTAMP},
								</if>
								<if test="addUserCode!=null">
									ADD_USER_CODE =#{addUserCode,jdbcType=VARCHAR},
								</if>
								<if test="destination!=null">
									DESTINATION =#{destination,jdbcType=VARCHAR},
								</if>
								<if test="followNo!=null">
									FOLLOW_NO =#{followNo,jdbcType=VARCHAR},
								</if>
								<if test="isDelete!=null">
									IS_DELETE =#{isDelete,jdbcType=VARCHAR},
								</if>
								<if test="isExport!=null">
									IS_EXPORT =#{isExport,jdbcType=VARCHAR},
								</if>
								<if test="isInitiative!=null">
									IS_INITIATIVE =#{isInitiative,jdbcType=VARCHAR},
								</if>
								<if test="isSupplierAddProduct!=null">
									IS_SUPPLIER_ADD_PRODUCT =#{isSupplierAddProduct,jdbcType=VARCHAR},
								</if>
								<if test="pakagesQty!=null">
									PAKAGES_QTY =#{pakagesQty,jdbcType=NUMERIC},
								</if>
								<if test="purchaserId!=null">
									PURCHASER_ID =#{purchaserId,jdbcType=VARCHAR},
								</if>
								<if test="purchaseOrderCode!=null">
									PURCHASE_ORDER_CODE =#{purchaseOrderCode,jdbcType=VARCHAR},
								</if>
								<if test="receiveAddress!=null">
									RECEIVE_ADDRESS =#{receiveAddress,jdbcType=VARCHAR},
								</if>
								<if test="receiveCompany!=null">
									RECEIVE_COMPANY =#{receiveCompany,jdbcType=VARCHAR},
								</if>
								<if test="receivePhoneno!=null">
									RECEIVE_PHONENO =#{receivePhoneno,jdbcType=VARCHAR},
								</if>
								<if test="receiveRemark!=null">
									RECEIVE_REMARK =#{receiveRemark,jdbcType=VARCHAR},
								</if>
								<if test="receiveUserName!=null">
									RECEIVE_USER_NAME =#{receiveUserName,jdbcType=VARCHAR},
								</if>
								<if test="receiveWarehouse!=null">
									RECEIVE_WAREHOUSE =#{receiveWarehouse,jdbcType=VARCHAR},
								</if>
								<if test="sendoutDate!=null">
									SENDOUT_DATE =#{sendoutDate,jdbcType=DATE},
								</if>
								<if test="sendoutGoodsCode!=null">
									SENDOUT_GOODS_CODE =#{sendoutGoodsCode,jdbcType=VARCHAR},
								</if>
								<if test="sendoutRemark!=null">
									SENDOUT_REMARK =#{sendoutRemark,jdbcType=VARCHAR},
								</if>
								<if test="sendoutStation!=null">
									SENDOUT_STATION =#{sendoutStation,jdbcType=VARCHAR},
								</if>
								<if test="sendoutStatus!=null">
									SENDOUT_STATUS =#{sendoutStatus,jdbcType=NUMERIC},
								</if>
								<if test="sourceType!=null">
									SOURCE_TYPE =#{sourceType,jdbcType=VARCHAR},
								</if>
								<if test="supplierContactPhoneno!=null">
									SUPPLIER_CONTACT_PHONENO =#{supplierContactPhoneno,jdbcType=VARCHAR},
								</if>
								<if test="supplierContactUser!=null">
									SUPPLIER_CONTACT_USER =#{supplierContactUser,jdbcType=VARCHAR},
								</if>
								<if test="supplierId!=null">
									SUPPLIER_ID =#{supplierId,jdbcType=VARCHAR},
								</if>
								<if test="totalBookQty!=null">
									TOTAL_BOOK_QTY =#{totalBookQty,jdbcType=NUMERIC},
								</if>
								<if test="totalPrice!=null">
									TOTAL_PRICE =#{totalPrice,jdbcType=NUMERIC},
								</if>
								<if test="totalRealityPrice!=null">
									TOTAL_REALITY_PRICE =#{totalRealityPrice,jdbcType=NUMERIC},
								</if>
								<if test="totalVarietyQty!=null">
									TOTAL_VARIETY_QTY =#{totalVarietyQty,jdbcType=NUMERIC},
								</if>
								<if test="transportCompany!=null">
									TRANSPORT_COMPANY =#{transportCompany,jdbcType=VARCHAR},
								</if>
								<if test="transportMode!=null">
									TRANSPORT_MODE =#{transportMode,jdbcType=VARCHAR},
								</if>
								<if test="transportNo!=null">
									TRANSPORT_NO =#{transportNo,jdbcType=VARCHAR},
								</if>
								<if test="transportPhoneno!=null">
									TRANSPORT_PHONENO =#{transportPhoneno,jdbcType=VARCHAR},
								</if>
								<if test="updateTime!=null">
									UPDATE_TIME =#{updateTime,jdbcType=TIMESTAMP},
								</if>
								<if test="updateUserCode!=null">
									UPDATE_USER_CODE =#{updateUserCode,jdbcType=VARCHAR},
								</if>
								<if test="yunhanOrderCode!=null">
									YUNHAN_ORDER_CODE =#{yunhanOrderCode,jdbcType=VARCHAR},
								</if>
								<if test="yunhanSendoutCode!=null">
									YUNHAN_SENDOUT_CODE =#{yunhanSendoutCode,jdbcType=VARCHAR},
								</if>
		</set>
		<where>
				ID=#{id}   
		</where>
	</update>
	
	
	<update id="updateProSendoutSummaryDelete" parameterType="ProSendoutSummaryBacktoCondition">
		UPDATE PRO_SENDOUT_SUMMARY
		<set>
					IS_DELETE ='Y',
					UPDATE_TIME =sysdate
		</set>
		<where>
			SENDOUT_GOODS_CODE = #{sendoutGoodsCode}
			and 	SUPPLIER_ID =#{supplierId}
			and 	PURCHASER_ID =#{purchaserId}
		</where>
	</update>
	
	
	
	
	
	<insert id="save" parameterType="ProSendoutSummaryBacktoDO">
		<selectKey resultType="java.lang.Long" order="BEFORE"
			keyProperty="id">
			SELECT PRO_SENDOUT_SUMMARY_SEQ.nextval AS 
															id
														 FROM dual
		</selectKey>
		INSERT INTO  PRO_SENDOUT_SUMMARY 
		(
				<if test="addTime!=null">
					ADD_TIME,
				</if>
				<if test="addUserCode!=null">
					ADD_USER_CODE,
				</if>
				<if test="destination!=null">
					DESTINATION,
				</if>
				<if test="followNo!=null">
					FOLLOW_NO,
				</if>
				<if test="id!=null">
					ID,
				</if>
				<if test="isDelete!=null">
					IS_DELETE,
				</if>
				<if test="isExport!=null">
					IS_EXPORT,
				</if>
				<if test="isInitiative!=null">
					IS_INITIATIVE,
				</if>
				<if test="isSupplierAddProduct!=null">
					IS_SUPPLIER_ADD_PRODUCT,
				</if>
				<if test="pakagesQty!=null">
					PAKAGES_QTY,
				</if>
				<if test="purchaserId!=null">
					PURCHASER_ID,
				</if>
				<if test="purchaseOrderCode!=null">
					PURCHASE_ORDER_CODE,
				</if>
				<if test="receiveAddress!=null">
					RECEIVE_ADDRESS,
				</if>
				<if test="receiveCompany!=null">
					RECEIVE_COMPANY,
				</if>
				<if test="receivePhoneno!=null">
					RECEIVE_PHONENO,
				</if>
				<if test="receiveRemark!=null">
					RECEIVE_REMARK,
				</if>
				<if test="receiveUserName!=null">
					RECEIVE_USER_NAME,
				</if>
				<if test="receiveWarehouse!=null">
					RECEIVE_WAREHOUSE,
				</if>
				<if test="sendoutDate!=null">
					SENDOUT_DATE,
				</if>
				<if test="sendoutGoodsCode!=null">
					SENDOUT_GOODS_CODE,
				</if>
				<if test="sendoutRemark!=null">
					SENDOUT_REMARK,
				</if>
				<if test="sendoutStation!=null">
					SENDOUT_STATION,
				</if>
				<if test="sendoutStatus!=null">
					SENDOUT_STATUS,
				</if>
				<if test="sourceType!=null">
					SOURCE_TYPE,
				</if>
				<if test="supplierContactPhoneno!=null">
					SUPPLIER_CONTACT_PHONENO,
				</if>
				<if test="supplierContactUser!=null">
					SUPPLIER_CONTACT_USER,
				</if>
				<if test="supplierId!=null">
					SUPPLIER_ID,
				</if>
				<if test="totalBookQty!=null">
					TOTAL_BOOK_QTY,
				</if>
				<if test="totalPrice!=null">
					TOTAL_PRICE,
				</if>
				<if test="totalRealityPrice!=null">
					TOTAL_REALITY_PRICE,
				</if>
				<if test="totalVarietyQty!=null">
					TOTAL_VARIETY_QTY,
				</if>
				<if test="transportCompany!=null">
					TRANSPORT_COMPANY,
				</if>
				<if test="transportMode!=null">
					TRANSPORT_MODE,
				</if>
				<if test="transportNo!=null">
					TRANSPORT_NO,
				</if>
				<if test="transportPhoneno!=null">
					TRANSPORT_PHONENO,
				</if>
				<if test="updateTime!=null">
					UPDATE_TIME,
				</if>
				<if test="updateUserCode!=null">
					UPDATE_USER_CODE,
				</if>
				<if test="yunhanOrderCode!=null">
					YUNHAN_ORDER_CODE,
				</if>
				<if test="yunhanSendoutCode!=null">
					YUNHAN_SENDOUT_CODE,
				</if>
		) VALUES (
				<if test="addTime!=null">
					#{addTime,jdbcType=TIMESTAMP},
				</if>
				<if test="addUserCode!=null">
					#{addUserCode,jdbcType=VARCHAR},
				</if>
				<if test="destination!=null">
					#{destination,jdbcType=VARCHAR},
				</if>
				<if test="followNo!=null">
					#{followNo,jdbcType=VARCHAR},
				</if>
				<if test="id!=null">
					#{id,jdbcType=NUMERIC},
				</if>
				<if test="isDelete!=null">
					#{isDelete,jdbcType=VARCHAR},
				</if>
				<if test="isExport!=null">
					#{isExport,jdbcType=VARCHAR},
				</if>
				<if test="isInitiative!=null">
					#{isInitiative,jdbcType=VARCHAR},
				</if>
				<if test="isSupplierAddProduct!=null">
					#{isSupplierAddProduct,jdbcType=VARCHAR},
				</if>
				<if test="pakagesQty!=null">
					#{pakagesQty,jdbcType=NUMERIC},
				</if>
				<if test="purchaserId!=null">
					#{purchaserId,jdbcType=VARCHAR},
				</if>
				<if test="purchaseOrderCode!=null">
					#{purchaseOrderCode,jdbcType=VARCHAR},
				</if>
				<if test="receiveAddress!=null">
					#{receiveAddress,jdbcType=VARCHAR},
				</if>
				<if test="receiveCompany!=null">
					#{receiveCompany,jdbcType=VARCHAR},
				</if>
				<if test="receivePhoneno!=null">
					#{receivePhoneno,jdbcType=VARCHAR},
				</if>
				<if test="receiveRemark!=null">
					#{receiveRemark,jdbcType=VARCHAR},
				</if>
				<if test="receiveUserName!=null">
					#{receiveUserName,jdbcType=VARCHAR},
				</if>
				<if test="receiveWarehouse!=null">
					#{receiveWarehouse,jdbcType=VARCHAR},
				</if>
				<if test="sendoutDate!=null">
					#{sendoutDate,jdbcType=DATE},
				</if>
				<if test="sendoutGoodsCode!=null">
					trim(#{sendoutGoodsCode,jdbcType=VARCHAR}),
				</if>
				<if test="sendoutRemark!=null">
					#{sendoutRemark,jdbcType=VARCHAR},
				</if>
				<if test="sendoutStation!=null">
					#{sendoutStation,jdbcType=VARCHAR},
				</if>
				<if test="sendoutStatus!=null">
					#{sendoutStatus,jdbcType=NUMERIC},
				</if>
				<if test="sourceType!=null">
					#{sourceType,jdbcType=VARCHAR},
				</if>
				<if test="supplierContactPhoneno!=null">
					#{supplierContactPhoneno,jdbcType=VARCHAR},
				</if>
				<if test="supplierContactUser!=null">
					#{supplierContactUser,jdbcType=VARCHAR},
				</if>
				<if test="supplierId!=null">
					#{supplierId,jdbcType=VARCHAR},
				</if>
				<if test="totalBookQty!=null">
					#{totalBookQty,jdbcType=NUMERIC},
				</if>
				<if test="totalPrice!=null">
					#{totalPrice,jdbcType=NUMERIC},
				</if>
				<if test="totalRealityPrice!=null">
					#{totalRealityPrice,jdbcType=NUMERIC},
				</if>
				<if test="totalVarietyQty!=null">
					#{totalVarietyQty,jdbcType=NUMERIC},
				</if>
				<if test="transportCompany!=null">
					#{transportCompany,jdbcType=VARCHAR},
				</if>
				<if test="transportMode!=null">
					#{transportMode,jdbcType=VARCHAR},
				</if>
				<if test="transportNo!=null">
					#{transportNo,jdbcType=VARCHAR},
				</if>
				<if test="transportPhoneno!=null">
					#{transportPhoneno,jdbcType=VARCHAR},
				</if>
				<if test="updateTime!=null">
					#{updateTime,jdbcType=TIMESTAMP},
				</if>
				<if test="updateUserCode!=null">
					#{updateUserCode,jdbcType=VARCHAR},
				</if>
				<if test="yunhanOrderCode!=null">
					#{yunhanOrderCode,jdbcType=VARCHAR},
				</if>
				<if test="yunhanSendoutCode!=null">
					#{yunhanSendoutCode,jdbcType=VARCHAR},
				</if>
		)
	</insert>
	
	<delete id="delete" parameterType="ProSendoutSummaryBacktoDO">
		DELETE FROM  PRO_SENDOUT_SUMMARY  WHERE 
			ID=#{id}   
	</delete>
	<!-- 根据回告细目ids生成发货单头信息  added luohoudong -->
	<select id="getSendoutHeaders"  parameterType="ProSendoutSummaryBacktoCondition"  resultType="ProSendoutSummaryBacktoDO">
	  with tmp as (select count(pi.id) as totalVarietyQty,
		       sum(nvl(resp.this_send_qty, 0)) as totalBookQty,
		       sum(resp.this_send_qty * resp.price) as totalPrice,
		       sum(resp.this_send_qty * resp.price * resp.discountrate / 100) as totalRealityPrice,
		       to_char(wm_concat(resp.id)) respids,
		       ps.destination as sendoutStation,
		       ps.purchaser_id as purchaserId,
		       ps.supplier_id as supplierId,
		       ps.warehouse as receiveWarehouse,
		       ps.send_goods_type,
		       d.name as supplierName
	  from pro_response_items resp
	  join pro_pur_order_items pi
	    on resp.pro_pur_order_items_id = pi.id
	  join pro_pur_order_summary ps
	    on (pi.purchase_order_code = ps.purchase_order_code and
	       pi.purchaser_id = ps.purchaser_id and
	       pi.supplier_id = ps.supplier_id)
	  join t_department d
	    on ps.supplier_id = d.sapvendorid
	 <where>
  		<![CDATA[
	    	resp.this_send_qty > 0 
	   ]]>
	   and resp.id in 
	   <foreach collection="responseItemsIds"  separator="," item="itemsId" open="(" close=")">
    		${itemsId}
	   </foreach>
	   </where>
		 group by ps.send_goods_type, ps.destination, ps.purchaser_id, ps.supplier_id, ps.warehouse, d.name),
	  tmp2 as (select 
		         ps.purchaser_id,
		         ps.receive_address,
		         ps.receive_phoneno,
		         ps.receive_contact_user
		     from pro_response_items resp
		     join pro_pur_order_items pi
		       on resp.pro_pur_order_items_id = pi.id
		     join pro_pur_order_summary ps
		       on (pi.purchase_order_code = ps.purchase_order_code and
		          pi.purchaser_id = ps.purchaser_id and
		          pi.supplier_id = ps.supplier_id)
		    WHERE 
			    <![CDATA[
		    		resp.this_send_qty > 0 
		   		]]>
		   	   and ps.SEND_GOODS_TYPE = '2'
			   and resp.id in 
			   <foreach collection="responseItemsIds"  separator="," item="itemsId" open="(" close=")">
		    		${itemsId}
			   </foreach>
		    group by  ps.purchaser_id, ps.receive_address, ps.receive_phoneno, ps.receive_contact_user)
		  select  
		          (case when tmp.send_goods_type='1' then  dc.paddr 
		            else tmp2.receive_address end) as receiveAddress,
		          (case when tmp.send_goods_type='1' then  dc.contact_number 
		            else tmp2.receive_phoneno end) as receivePhoneno,
		          (case when tmp.send_goods_type='1' then  dc.contact 
		            else tmp2.receive_contact_user end) as receiveUserName,   
		          tmp.*
		   from tmp 
		   left join  tmp2
        		on tmp.purchaserId=tmp2.purchaser_id
   		   left join dc_location dc
     			on tmp.receiveWarehouse = dc.code and tmp.send_goods_type = '1'
	</select>
	
	<!-- 根据回告细目ids生成发货单头信息  added luohoudong -->
	<select id="findSupplierIdSendoutGoodsIsExist"  parameterType="ProSendoutSummaryBacktoCondition"  resultType="java.lang.Integer">
		select 
			count(1)
		from pro_sendout_items pi
		 where pi.sendout_goods_code ='${sendoutGoodsCode}'
		   and pi.supplier_id ='${supplierId}'
		   and pi.purchaser_id !='${purchaserId}'
		   and pi.is_delete='N'
	</select>
	
	<!-- 检查发货单是否可以追加   如果 flagNum大于1则追加的发货单品种已收货 ; 如果flagNum等于1 则追加的发货单仓位不一致;如果等于0则可以追加 ;-1则订单号不重复-->
	<select id="checkSendoutAdditional"  parameterType="ProSendoutSummaryBacktoCondition" resultType="java.lang.Integer">
		select 
	  			ms.flag
	          from (select (case
	                         when pi.status in (30, 35) then 2
	                         when  psi.status in (10, 15) then 2
	                         when ps.warehouse != '${receiveWarehouse}' then 1
	                         when pss.receive_warehouse !='${receiveWarehouse}' then 1
	                         when pss.receive_warehouse is null then  -1
	                         else 0 end) as flag
	                  from pro_sendout_items psi 
	                  left join pro_sendout_summary pss
	                    on psi.sendout_goods_code = pss.sendout_goods_code
	                   and psi.purchaser_id = pss.purchaser_id
	                   and psi.supplier_id = pss.SUPPLIER_ID
	                   and pss.IS_DELETE = 'N'
	                  left join pro_pur_order_items pi 
						on  psi.pro_pur_order_items_id=pi.id
						<if test="orderItemsIds!=null">
			                 and pi.id in
		                 	  <foreach collection="orderItemsIds"  separator="," item="itemsId" open="(" close=")">
						    		${itemsId}
							  </foreach>
						</if> 
	                  left join pro_pur_order_summary ps
	                    on pi.yunhan_order_code = ps.yunhan_order_code
	                    and pi.purchaser_id=ps.purchaser_id
	                    and pi.supplier_id=ps.supplier_id
	                 where 
	                 	     psi.purchaser_id='${purchaserId}'
	                 	 and psi.supplier_id='${supplierId}'
						 and psi.is_delete='N'
						 and psi.sendout_goods_code = #{sendoutGoodsCode}
		                 
	                 ) ms
	         group by ms.flag
	</select>
	
	<!-- 保存发货单总目信息(用于回告发货:码洋、实洋  根据发货单细目计算) added by luohoudong -->
	<insert id="saveProSendoutSummaryDO" parameterType="ProSendoutSummaryBacktoDO">
		<selectKey resultType="java.lang.Long" order="BEFORE"
			keyProperty="id">
			SELECT PRO_SENDOUT_SUM_SEQ.nextval AS 
															id
														 FROM dual
		</selectKey>
		INSERT INTO  PRO_SENDOUT_SUMMARY 
		(		
					TOTAL_BOOK_QTY,
					TOTAL_VARIETY_QTY,
					TOTAL_PRICE,
					TOTAL_REALITY_PRICE,
					IS_INITIATIVE,
					ADD_TIME,
				<if test="addUserCode!=null">
					ADD_USER_CODE,
				</if>
				<if test="destination!=null">
					DESTINATION,
				</if>
				<if test="followNo!=null">
					FOLLOW_NO,
				</if>
				<if test="isDelete!=null">
					IS_DELETE,
				</if>
				<if test="isExport!=null">
					IS_EXPORT,
				</if>
				<if test="isSupplierAddProduct!=null">
					IS_SUPPLIER_ADD_PRODUCT,
				</if>
				<if test="pakagesQty!=null">
					PAKAGES_QTY,
				</if>
				<if test="purchaserId!=null">
					PURCHASER_ID,
				</if>
				<if test="purchaseOrderCode!=null">
					PURCHASE_ORDER_CODE,
				</if>
				<if test="receiveAddress!=null">
					RECEIVE_ADDRESS,
				</if>
				<if test="receiveCompany!=null">
					RECEIVE_COMPANY,
				</if>
				<if test="receivePhoneno!=null">
					RECEIVE_PHONENO,
				</if>
				<if test="receiveRemark!=null">
					RECEIVE_REMARK,
				</if>
				<if test="receiveUserName!=null">
					RECEIVE_USER_NAME,
				</if>
				<if test="receiveWarehouse!=null">
					RECEIVE_WAREHOUSE,
				</if>
				<if test="sendoutDate!=null">
					SENDOUT_DATE,
				</if>
				<if test="sendoutGoodsCode!=null">
					SENDOUT_GOODS_CODE,
				</if>
				<if test="sendoutRemark!=null">
					SENDOUT_REMARK,
				</if>
				<if test="sendoutStation!=null">
					SENDOUT_STATION,
				</if>
				<if test="sendoutStatus!=null">
					SENDOUT_STATUS,
				</if>
				<if test="sourceType!=null">
					SOURCE_TYPE,
				</if>
				<if test="supplierContactPhoneno!=null">
					SUPPLIER_CONTACT_PHONENO,
				</if>
				<if test="supplierContactUser!=null">
					SUPPLIER_CONTACT_USER,
				</if>
				<if test="supplierId!=null">
					SUPPLIER_ID,
				</if>
				<if test="transportCompany!=null">
					TRANSPORT_COMPANY,
				</if>
				<if test="transportMode!=null">
					TRANSPORT_MODE,
				</if>
				<if test="transportNo!=null">
					TRANSPORT_NO,
				</if>
				<if test="transportPhoneno!=null">
					TRANSPORT_PHONENO,
				</if>
				<if test="updateTime!=null">
					UPDATE_TIME,
				</if>
				<if test="updateUserCode!=null">
					UPDATE_USER_CODE,
				</if>
				<if test="yunhanOrderCode!=null">
					YUNHAN_ORDER_CODE,
				</if>
				<if test="yunhanSendoutCode!=null">
					YUNHAN_SENDOUT_CODE,
				</if>
				ID
		) 
				select 
			 	sum(nvl(pi.sendout_qty, 0)) as TOTAL_BOOK_QTY,
	       		count(1) as TOTAL_VARIETY_QTY,
	       		sum(pi.sendout_qty * pi.sendout_price) as TOTAL_PRICE,
	       		sum(pi.sendout_qty * pi.sendout_price * pi.sendout_discountrate*0.01) as TOTAL_REALITY_PRICE,
	       		'N',
				sysdate,
				<if test="addUserCode!=null">
					'${addUserCode}',
				</if>
				<if test="destination!=null">
					#{destination},
				</if>
				<if test="followNo!=null">
					#{followNo},
				</if>
				<if test="isDelete!=null">
					#{isDelete},
				</if>
				<if test="isExport!=null">
					#{isExport},
				</if>
				<if test="isSupplierAddProduct!=null">
					#{isSupplierAddProduct},
				</if>
				<if test="pakagesQty!=null">
					#{pakagesQty},
				</if>
				<if test="purchaserId!=null">
					#{purchaserId},
				</if>
				<if test="purchaseOrderCode!=null">
					#{purchaseOrderCode},
				</if>
				<if test="receiveAddress!=null">
					#{receiveAddress},
				</if>
				<if test="receiveCompany!=null">
					#{receiveCompany},
				</if>
				<if test="receivePhoneno!=null">
					#{receivePhoneno},
				</if>
				<if test="receiveRemark!=null">
					#{receiveRemark},
				</if>
				<if test="receiveUserName!=null">
					#{receiveUserName},
				</if>
				<if test="receiveWarehouse!=null">
					#{receiveWarehouse},
				</if>
				<if test="sendoutDate!=null">
					#{sendoutDate},
				</if>
				<if test="sendoutGoodsCode!=null">
					#{sendoutGoodsCode},
				</if>
				<if test="sendoutRemark!=null">
					#{sendoutRemark},
				</if>
				<if test="sendoutStation!=null">
					#{sendoutStation},
				</if>
				<if test="sendoutStatus!=null">
					#{sendoutStatus},
				</if>
				<if test="sourceType!=null">
					#{sourceType},
				</if>
				<if test="supplierContactPhoneno!=null">
					#{supplierContactPhoneno},
				</if>
				<if test="supplierContactUser!=null">
					#{supplierContactUser},
				</if>
				<if test="supplierId!=null">
					#{supplierId},
				</if>
				<if test="transportCompany!=null">
					#{transportCompany},
				</if>
				<if test="transportMode!=null">
					#{transportMode},
				</if>
				<if test="transportNo!=null">
					#{transportNo},
				</if>
				<if test="transportPhoneno!=null">
					#{transportPhoneno},
				</if>
				<if test="updateTime!=null">
					#{updateTime},
				</if>
				<if test="updateUserCode!=null">
					#{updateUserCode},
				</if>
				<if test="yunhanOrderCode!=null">
					#{yunhanOrderCode},
				</if>
				<if test="yunhanSendoutCode!=null">
					#{yunhanSendoutCode},
				</if>
				#{id}
  		from pro_sendout_items pi
 		where 	  pi.sendout_goods_code = #{sendoutGoodsCode}
   			  and pi.supplier_id  = '${supplierId}'
   			  and pi.purchaser_id = '${purchaserId}' 
   			  and pi.IS_DELETE='N'
				
	</insert>
	<!--  根据发货单号查询发货单总目信息  added by luohoudong -->
	<select id="findProSendoutSummaryBySendoutGoodsCode"  parameterType="ProSendoutSummaryBacktoCondition"  resultType="ProSendoutSummaryBacktoDO">
		select 
	       ps.*
	  	from pro_sendout_summary ps 
	  <where>
	  	   ps.SENDOUT_GOODS_CODE=#{sendoutGoodsCode}
	  	   and ps.PURCHASER_ID=#{purchaserId}
	  	   and ps.SUPPLIER_ID=#{supplierId}
	  	   and ps.IS_DELETE='N'
	  </where>
	</select>
	<!-- 追加发货时,更新发货单总目信息(用于回告发货 码洋、实洋  根据发货单细目计算) added by luohoudong -->
	<update id="updateProSendoutSummaryDO" parameterType="ProSendoutSummaryBacktoCondition">
		 <include refid="reCalculationSendOutSummarySql"></include>
	</update>

	<!--根据ids 查询发货单 yangtao 20160728-->
	<select id="queryProSendoutSummary" resultMap="ProSendoutSummaryResult" 
		parameterType="ProSendoutSummaryBacktoCondition">
		SELECT  s.ID,
	   nvl(s.receive_warehouse,'QITA') as receive_warehouse,
	   nvl(dc.name,'其他') as receiveWarehouseName,
       s.SENDOUT_GOODS_CODE,
       s.ADD_TIME,
       s.RECEIVE_COMPANY,
       s.TOTAL_VARIETY_QTY,
       s.TOTAL_BOOK_QTY,
       s.TOTAL_PRICE,
       s.TOTAL_REALITY_PRICE,
       s.SENDOUT_DATE,
       s.SENDOUT_STATUS,
       s.IS_INITIATIVE,
       s.IS_SUPPLIER_ADD_PRODUCT,
	   s.TRANSPORT_MODE,
       s.SUPPLIER_ID,
       s.PURCHASER_ID,
       s.TRANSPORT_COMPANY,
       s.TRANSPORT_NO,
       s.TRANSPORT_MODE,
       s.PAKAGES_QTY,
       s.DESTINATION,
       s.SENDOUT_REMARK,
       s.RECEIVE_USER_NAME,
       s.RECEIVE_PHONENO,
       s.SENDOUT_STATION,
       d.name as purchaserName
  		FROM PRO_SENDOUT_SUMMARY s 
  		join t_department d 
       		on s.purchaser_id=d.sapvendorid
       	left join dc_location dc 
     		on s.receive_warehouse=dc.code
		where  exists (
			select 1 from pro_sendout_items si
    		where s.sendout_goods_code = si.sendout_goods_code and si.IS_DELETE = 'N'
	     	<if  test="purchaseOrderCodes!=null">
			AND si.PURCHASE_ORDER_CODE IN
				<foreach collection="purchaseOrderCodes" item="orderCode" separator="," open=" (" close=" ) ">
		      '${orderCode}'
				</foreach>
			</if>
			<if  test="purchaseOrderCode!=null">
			AND si.PURCHASE_ORDER_CODE like '%'||#{purchaseOrderCode}||'%'
			</if>
			
     	)
		and s.IS_DELETE='N'
    	AND s.SENDOUT_STATUS != 0
		<if  test="id!=null">
        	AND s.ID = #{id}
		</if>
        <if  test="ids!=null">
        AND s.ID IN
        <foreach collection="ids" item="id" separator="," open=" (" close=" ) ">
		      '${id}'
		</foreach>
		</if>
		<if  test="sendoutGoodsCodes!=null">
			AND s.SENDOUT_GOODS_CODE IN
			<foreach collection="sendoutGoodsCodes" item="goodsCode" separator="," open=" (" close=" ) ">
			      '${goodsCode}'
			</foreach>
		</if>
		<if test="sendoutGoodsCode!=null">
			and s.sendout_goods_code like '%'||#{sendoutGoodsCode}||'%'
		</if>
		<if  test="receiveCompany!=null">
			AND s.purchaser_id = '${receiveCompany}' <!-- 暂时用采购商 -->
		</if>
		<if test="receiveWarehouse!=null">
			AND nvl(s.receive_warehouse,'QITA') = '${receiveWarehouse}'
		</if>
		<if  test="receiveWarehouses!=null">
			AND nvl(s.receive_warehouse,'QITA') in
			<foreach collection="receiveWarehouses" item="receiveWarehouseItem"  open="(" separator="," close=")">  
		           #{receiveWarehouseItem}  
		     </foreach>	
		 </if>
		<if test="purchaserId!=null">
			and s.purchaser_id = #{purchaserId}
		</if>
		<if test="supplierId!=null">
			and s.SUPPLIER_ID = #{supplierId}
		</if>
				<!-- end -->
		<if  test="sendoutStatus!=null">
			AND s.SENDOUT_STATUS = ${sendoutStatus}
		</if>
		<if  test="sendoutStatuss!=null">
			AND s.SENDOUT_STATUS IN
			<foreach collection="sendoutStatuss" item="sendoutStatus" separator="," open=" ( " close=" ) ">
			   ${sendoutStatus}
			 </foreach> 
		</if>
		<if  test="sendoutDateFrom!=null">
		   <![CDATA[ 
			AND s.SENDOUT_DATE >= to_date('${sendoutDateFrom} 00:00:00','YYYY-MM-DD hh24:mi:ss')
			]]>
		</if>
		 <if  test="sendoutDateTo!=null">
		 <![CDATA[ 
			AND s.SENDOUT_DATE <= to_date('${sendoutDateTo} 23:59:59','YYYY-MM-DD hh24:mi:ss')
			]]>
		</if>
		<if  test="addDateFrom!=null">
		   <![CDATA[ 
			AND s.ADD_TIME >= to_date('${addDateFrom} 00:00:00','YYYY-MM-DD hh24:mi:ss')
			]]>
		</if>
		 <if  test="addDateTo!=null">
		 <![CDATA[ 
			AND s.ADD_TIME <= to_date('${addDateTo} 23:59:59','YYYY-MM-DD hh24:mi:ss')
			]]>
		</if>
		<if  test="isInitiative!=null">
			AND s.IS_INITIATIVE = '${isInitiative}'
		</if> 
		<if  test="addUserCode!=null">
			and s.purchaser_id in (
        		select t.parameter_value1 from t_config_parameter t where t.user_code = #{addUserCode} and t.parameter_code1 ='PURCHASER_ID'
  			)
		</if> 
		<if test="yunhanOrderCode!=null">
			s.YUNHAN_ORDER_CODE =${yunhanOrderCode},
		</if>
		
		ORDER BY s.ADD_TIME DESC
	</select>
	
	<select id="queryProSendoutSummary_count" resultType="java.lang.Integer" 
		parameterType="ProSendoutSummaryBacktoCondition">
		SELECT count(1) 
		FROM PRO_SENDOUT_SUMMARY s 
		join t_department d 
       	on s.purchaser_id=d.sapvendorid
		where exists (
			select 1 from pro_sendout_items si
    	 	where s.sendout_goods_code = si.sendout_goods_code and si.IS_DELETE = 'N'
	     	<if  test="purchaseOrderCodes!=null">
			AND si.PURCHASE_ORDER_CODE IN
				<foreach collection="purchaseOrderCodes" item="orderCode" separator="," open=" (" close=" ) ">
		      '${orderCode}'
				</foreach>
			</if>
			<if  test="purchaseOrderCode!=null">
			AND si.PURCHASE_ORDER_CODE like '%'||#{purchaseOrderCode}||'%'
			</if>
     	)
		
				and s.IS_DELETE='N'
		    	AND SENDOUT_STATUS != 0
		         <if  test="ids!=null">
		        AND s.ID IN
		        <foreach collection="ids" item="id" separator="," open=" (" close=" ) ">
				      '${id}'
				</foreach>
				</if>
				<if  test="sendoutGoodsCodes!=null">
					AND s.SENDOUT_GOODS_CODE IN
					<foreach collection="sendoutGoodsCodes" item="goodsCode" separator="," open=" (" close=" ) ">
					      '${goodsCode}'
					</foreach>
				</if>
				<if test="sendoutGoodsCode!=null">
					and s.sendout_goods_code like '%'||#{sendoutGoodsCode}||'%'
				</if>
				<if  test="receiveCompany!=null">
					AND s.purchaser_id = '${receiveCompany}'
				</if>
				<if test="receiveWarehouse!=null">
					AND nvl(s.receive_warehouse,'QITA') = '${receiveWarehouse}'
				</if>
				<if  test="receiveWarehouses!=null">
					AND nvl(s.receive_warehouse,'QITA') in
					<foreach collection="receiveWarehouses" item="receiveWarehouseItem"  open="(" separator="," close=")">  
				           #{receiveWarehouseItem}  
				     </foreach>	
				 </if>
				<if test="purchaserId!=null">
					and s.purchaser_id = #{purchaserId}
				</if>
				<if  test="sendoutStatus!=null">
					AND s.SENDOUT_STATUS = ${sendoutStatus}
				</if>
				<if  test="sendoutStatuss!=null">
					AND s.SENDOUT_STATUS IN
					<foreach collection="sendoutStatuss" item="sendoutStatus" separator="," open=" ( " close=" ) ">
					   ${sendoutStatus}
					 </foreach> 
				</if>
				<if  test="purchaseOrderCodes!=null">
					AND s.PURCHASE_ORDER_CODE IN
				<foreach collection="purchaseOrderCodes" item="purchaseOrderCode" separator="," open=" (" close=" ) ">
				      '${purchaseOrderCode}'
				</foreach>
				</if>
				<if  test="sendoutDateFrom!=null">
				   <![CDATA[ 
					AND s.SENDOUT_DATE >= to_date('${sendoutDateFrom}','YYYY-MM-DD')
					]]>
				</if>
				 <if  test="sendoutDateTo!=null">
				 <![CDATA[ 
					AND s.SENDOUT_DATE <= to_date('${sendoutDateTo}','YYYY-MM-DD')
					]]>
				</if>
				<if test="addDateFrom!=null">
					   <![CDATA[ 
						AND s.ADD_TIME >= to_date('${addDateFrom} 00:00:00','YYYY-MM-DD hh24:mi:ss')
						]]>
				</if>
				<if test="addDateTo!=null">
					 <![CDATA[ 
						AND s.ADD_TIME <= to_date('${addDateTo} 23:59:59','YYYY-MM-DD hh24:mi:ss')
						]]>
				</if>
				<if  test="isInitiative!=null">
					AND s.IS_INITIATIVE = '${isInitiative}'
				</if> 
				<if  test="supplierId!=null">
					AND s.SUPPLIER_ID = '${supplierId}'
				</if> 
				<!-- <if  test="addUserCode!=null">
					AND s.ADD_USER_CODE = '${addUserCode}'
				</if>  -->
				<if  test="addUserCode!=null">
					and s.purchaser_id in (
		        		select t.parameter_value1 from t_config_parameter t where t.user_code = #{addUserCode} and t.parameter_code1 ='PURCHASER_ID'
		  			)
				</if> 
				<if test="supplierId!=null">
					and s.SUPPLIER_ID = #{supplierId}
				</if>
	</select>
		<select id="findSendOutSummaryById" resultMap="ProSendoutSummaryResult" 
		parameterType="ProSendoutSummaryBacktoCondition" >
	select t.id from PRO_SENDOUT_SUMMARY t 
	     <where>
	      	      t.sendout_status in (10,15)
	          and t.IS_DELETE='N'
	         <if  test="id!=null">
				 and t.id='${id}'
			</if>
	    </where>
	</select>
	<!-- 重新计算发货单总目上的总实洋 总码洋 发货总册数 发货品种总数  -->
	<update id="reCalculationSendOutSummary" parameterType="ProSendoutSummaryBacktoCondition">
		<include refid="reCalculationSendOutSummarySql"></include>
	</update>
	<!-- 重新计算发货单总目上的总实洋 总码洋 发货总册数 发货品种总数 sql -->
	<sql id="reCalculationSendOutSummarySql">
		UPDATE pro_sendout_summary t
		set (
		<if test="isSupplierAddProduct!=null">
		t.IS_SUPPLIER_ADD_PRODUCT,
		</if>
		t.total_book_qty,
		t.total_variety_qty,
		t.total_price,
		t.total_reality_price) =
		(select 
		<if test="isSupplierAddProduct!=null">
			#{isSupplierAddProduct},
		</if>
		sum(nvl(pi.sendout_qty, 0)) as TOTAL_BOOK_QTY,
		count(1) as TOTAL_VARIETY_QTY,
		sum(pi.sendout_qty * pi.sendout_price) as TOTAL_PRICE,
		sum(pi.sendout_qty * pi.sendout_price *
		pi.sendout_discountrate *0.01) as TOTAL_REALITY_PRICE
		from pro_sendout_items pi
		where pi.is_delete = 'N'
		and pi.sendout_goods_code = t.sendout_goods_code
		and pi.supplier_id = t.supplier_id
		and pi.purchaser_id = t.purchaser_id)
		<where>
			t.sendout_goods_code = #{sendoutGoodsCode}
			and t.supplier_id = #{supplierId}
			and t.purchaser_id = #{purchaserId}
			and t.IS_DELETE='N'
		</where>
	</sql>
</mapper>